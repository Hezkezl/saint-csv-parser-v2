# SaintCoinach CSV Parser


A small micro-service for parsing the RAW-EXD generated by [SaintCoinach](https://github.com/ufx/SaintCoinach). The data is pulled from the [FFXIV-Datamining Repository](https://github.com/viion/ffxiv-datamining).

___

## Requirements

- You will need PHP 7+ installed
- You will need Composer installed

## Usage

- `git clone https://github.com/viion/saint-csv-parser-v2.git`
- `cd saint-csv-parser-v2`
- `composer install`
- `php bin/console app:parse:csv [Project:Parse]`

## Building your own parser

To use this tool you need to write a CSV Parsing file. The concept works around a **Project Folder** and a **Parser File**.

Start by creating a parser file, open up Command Prompt and `cd` into the repository, then run the command:

- `php bin/console app:parse:create Hello World`
```
$ php bin/console app:parse:create Hello World

Creating Parse File
- Folder: Hello
- Filename: World
Generated file: /path/to/repo/src/Parsers/Hello/World.php
Run as command: php bin/console app:parse:csv Hello:World
```

This will generate the file `World.php` in the folder `src/Parser/Hello`. This is where your code will live.

You can test run your parser straight away by running:

- `php bin/console app:parse:csv Hello:World`
```
php bin/console app:parse:csv Hello:World
Starting CSV Parser
- MEMORY: 1280M
- START: 2018-02-06 12:42:09
- PARSER: Hello:World
Intializing parsing class: \App\Parsers\Hello\World
Hello:World
 22600/22600 [============================] 100%Finished!

Finished!
- Duration: 6.421 seconds
```



- `src/Parsers/MyAwesomeParser`

In here you will want to make a PHP file for the type of content you want to parse, eg:

- `MyItemParser.php`

Populate the file with the skeleton code:

```php
<?php

namespace App\Parsers\MyAwesomeParser;

use App\Parsers\CsvParseTrait;
use App\Parsers\ParseInterface;

class MyItemParser implements ParseInterface
{
    use CsvParseTrait;

    public function parse()
    {

    }
}

```

To begin writing your parser, open up the file:

- **src/Parsers/Hello/World.php**

Some skeleton code is included to get you started



## Functions

**$this->getCsvFile([filename])**

Get a CSV file based on its exact filename, eg:

```php
$itemCsv = $this->getCsvFile('Item');
```

Loop through data:

```php
foreach($itemCsv->data as $id => $row) {
    $this->output->write('Item Name: '. $row['Name']);
}
```

**$csv->at([id])**

If you are extending to other files and need a row at a specific id, you can use `at()`, eg:

```php
$memberType = $contentMemberTypeCsv->at($conditions['ContentMemberType']);
```

**$csv->find([column], [value])**

If you need to find a row(s) to a specific value, you can use `find()`, eg:

```php
$conditions = $contentFinderConditionCsv->find('InstanceContent', $id);
```

**$this->dump([filename], [data])**

Save data to the cache directory as `dump_<filename>`, eg:

```php
$this->dump('InstanceContentJson', json_encode($data, JSON_PRETTY_PRINT));
```

**$this->dumpChunks([filename])**

Save data in multiple files as "chunks", it will save 200 entries per file.

```php
$this->dumpChunks('QuestData');
```


## Clear cache

- `php bin/console app:parse:clear-cache`

